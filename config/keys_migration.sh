#!/system/bin/sh

# SPDX-FileCopyrightText: 2017-2024 The LineageOS Project
# SPDX-License-Identifier: Apache-2.0

# First time we change keys, keep track of it
migration_file="/data/system/keys_migration_1"

new_platform_signature="308203453082022da00302010202141bd4cb3a45b3338e1e07d3cb2381918a1ab17ff1300d06092a864886f70d01010b05003031310b3009060355040613025553310e300c06035504080c054974616c793112301006092a864886f70d01090116034e614e3020170d3234303532363230333332385a180f32303531313031323230333332385a3031310b3009060355040613025553310e300c06035504080c054974616c793112301006092a864886f70d01090116034e614e30820122300d06092a864886f70d01010105000382010f003082010a0282010100e7de79cb729b0cadc56d0d3e08cb250066f34451c15590da3e8b871d21edea1459ee23c385ad728c7f3831694c2b1605cac1237ac5ccf6014f9862b390aba7df3ac5217161a56b237a415316330ab179d2f2ad17bd0b4a864c3e84c1bf280f79158e623560087ec7e1f09b5d294cf9ad2a89d198e2fbb200a2d719e8024979433ff2a591b4b3055ef3b3d7aa32dd1df34cf9f8bc54d2c4f49793079d25570617df16e354069a73eb68115ef02c874557282f0896d5d52b51dfa4c448de1ac06c64de620d87221bef8c95fe431fcd471e9a0281fdee7afa73be11d6e4f970797d6660be7a628a5a016a515c376fd6e25c76b5463722be773b7a0715333a82921f0203010001a3533051301d0603551d0e041604149b089437b7b30408878307c9bb73726786f3b38d301f0603551d230418301680149b089437b7b30408878307c9bb73726786f3b38d300f0603551d130101ff040530030101ff300d06092a864886f70d01010b05000382010100c5d61a812b8580521cc8455c3b1baeb86a3e0e28c07dbf2e1803b3014b19be1d104cc20b019548e8ebfb9d6a7883dc92506a2d2c216e169563d80dcc473649811af4e60ae96301e7b920d4e19e811462f60c17792cbd659646b50ec58a9d88f4e073dbeddb70a27691a4bd230f8c3d7f47b582e704302e573e3e2889520d4235b53cb744af29eb0b89edc1459fa8bf016c4edbdb265a47ebc46eff52636217f56f7f36aac06a00f18160b7faeb21b6b89f0ec835ead14929baad195fd37aae10f559e3a5ee4896381302424ab7a04b155c08ac6dd75bb7130a35c6c9aceb8e11536a292793b3100c706dbb09b3fd3db6ffb8d49390628a7747a69071830949bf"

selinux_mac_file="/system/etc/selinux/plat_mac_permissions.xml"

# Safety check: verify that we are indeed running on a system with the new keys
if [[ ! $(/system/bin/grep -i $new_platform_signature $selinux_mac_file) ]]; then
    exit 2
fi

# Wait for /data to be mounted
while [[ ! -d /data/system ]]
do
    /system/bin/sleep 1
done

# Check if we already migrated in the past
# /data/system is not encrypted so we don't have to worry about that
if [[ -f $migration_file ]]; then
    exit 1
fi

# New public keys
bluetooth_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAsdVUDler/YbqtaJ+rivGWV/H/iP9hekeQMpKdV7p5Dn4VNEjHIFOGuYpdKVBEU+1MdnH7vnmznQd70HPzRUVUBdsW9ET4HZcmE0gRQn7RbfQVQS81Z2xMYMpccUggQnO+H4+6E3iendVHSiGgFJOZeKTHbsZqBkXRqLmaO/8JHuN7+9mkh95nQxeaE8MDed7mb1kpt0mbAnt8xkKPt2fN1h61OfK/K/qooVMHZpRalGrfv/RJ77MwHNkzJjHCDHUSI4TNUnUPnBc8gd658M9aeWJGGrTzgss9ozuLiX1THk8bkqMCTUnIg4qdCXZnpYUUuG+vzv/xQGOsNO6wkcK1QIDAQAB"
bluetooth_cert_release="308203453082022DA0030201020214567ACB554CEF70B72CC1D90751A1982219A15665300D06092A864886F70D01010B05003031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E3020170D3234303532363231303432375A180F32303531313031323231303432375A3031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E30820122300D06092A864886F70D01010105000382010F003082010A0282010100B1D5540E57ABFD86EAB5A27EAE2BC6595FC7FE23FD85E91E40CA4A755EE9E439F854D1231C814E1AE62974A541114FB531D9C7EEF9E6CE741DEF41CFCD151550176C5BD113E0765C984D204509FB45B7D05504BCD59DB131832971C5208109CEF87E3EE84DE27A77551D288680524E65E2931DBB19A8191746A2E668EFFC247B8DEFEF66921F799D0C5E684F0C0DE77B99BD64A6DD266C09EDF3190A3EDD9F37587AD4E7CAFCAFEAA2854C1D9A516A51AB7EFFD127BECCC07364CC98C70831D4488E133549D43E705CF2077AE7C33D69E589186AD3CE0B2CF68CEE2E25F54C793C6E4A8C093527220E2A7425D99E961452E1BEBF3BFFC5018EB0D3BAC2470AD50203010001A3533051301D0603551D0E041604141D5446675E94D13A753E2335A1F93DD5DD66376F301F0603551D230418301680141D5446675E94D13A753E2335A1F93DD5DD66376F300F0603551D130101FF040530030101FF300D06092A864886F70D01010B0500038201010006F6307AD19C6B17F6368847AD59C5547A818AE8B82AB17FF62233FD947C9466B67CDAB4D6FDCADB06FA2B6B50579A3AE3CAADE50F120C5F116DBF4658BB143BA2FFC28FFF246A9679211BF8FC5B7E51EFC0883E07DCA8461DA37AE166DA5182F853FD36DD18ED00526A3AAC2740255E46261E4D6B50946B755295A444DC38CEE84EC4D91CB562039A0F860F10D169EE0953FF10CAE45E05DDBD428701EF2365D5217B46EAB5AE5465AE12D72F70A8611329BDD2ABC1310DB8A2D76D455C41857C6B0F07FAB3ED8FB61DFFAD3BDC0E68B1EE5D85B9F0DDC599D846D03B2145EFB28B9491D14A8CFBBA4AC4D0B0928F53F19883412980E661C67F38CC5FC615E5"
media_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtUUMoXQhhvR7wU4zJ18XS9bh9xFSLhSq2yr4cV+1Qs+/SQCjU0GaUvg0ylnB9bqKRSFOg7GbUyv9wNafMdd1QKLBO93kzecZH/3euBDwVqN7PEPLjDRY4QjKA5TCKH07XNFOAJ1JAADJMklZ4AWwSKOixAfJNzp3Kb/f1BBI6qcYY80lKxf676wmuzCdFwsQO6pcR5DPernxXHHVCZBwd3b47XHJPLUwrtszTMah4oCxC07QXQ5iJvT+pF+R2buXBO4iwbanMeUUG75TUuUFtXlXYqoGfwCmxUYdMDKlnCCplyR/LHj2uPYjJ7YD23oebMXOJrYqnNkuLGFdol41TwIDAQAB"
media_cert_release="308203453082022DA00302010202143A954FD633FCFD3FE2566FE72BFFDE4FF70BC23B300D06092A864886F70D01010B05003031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E3020170D3234303532363230333332385A180F32303531313031323230333332385A3031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E30820122300D06092A864886F70D01010105000382010F003082010A0282010100B5450CA1742186F47BC14E33275F174BD6E1F711522E14AADB2AF8715FB542CFBF4900A353419A52F834CA59C1F5BA8A45214E83B19B532BFDC0D69F31D77540A2C13BDDE4CDE7191FFDDEB810F056A37B3C43CB8C3458E108CA0394C2287D3B5CD14E009D490000C9324959E005B048A3A2C407C9373A7729BFDFD41048EAA71863CD252B17FAEFAC26BB309D170B103BAA5C4790CF7AB9F15C71D50990707776F8ED71C93CB530AEDB334CC6A1E280B10B4ED05D0E6226F4FEA45F91D9BB9704EE22C1B6A731E5141BBE5352E505B5795762AA067F00A6C5461D3032A59C20A997247F2C78F6B8F62327B603DB7A1E6CC5CE26B62A9CD92E2C615DA25E354F0203010001A3533051301D0603551D0E04160414CDF5D76ED53BB71973A0B4E2CDC9A82CD760C6D2301F0603551D23041830168014CDF5D76ED53BB71973A0B4E2CDC9A82CD760C6D2300F0603551D130101FF040530030101FF300D06092A864886F70D01010B050003820101005A0E3D1B88E627E72D9A7711BF2F64DB6B6121F14E0946B58C8BB7F92300BCBBC4979FC7793EBD63D44992137D3D1A80F9CD2306421E3378E2C3D0D236E8F94FF9AD9D76580F581E7F962FAB358708B07FF6468D6C6A7C21AFC57604DB8200E894EBE88AA40F1340A4FEAEE1C0EFE39DA35101F2DADB577B20BB3CE69D5E0AED7C5D16A7F92C3431C3F5814513C35B139664785FC856F5BE1436358E6B1F6859374F43D6F33918FECD3B5F7EFB2D3E047C5E8E112396023E5E10BBFBD3F958A6AFEF2A0DE82CF945854F1A9FB9DAD79E5DEFE68B7287C168D65CBE58651EEB0084C304928066DE200E701C56208E43B20C826170220EA55C114FAC5B8D7FF113"
networkstack_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA84JCwu7Ykm8+H4iBYpkNo6e3XgkCQUq4VptLaaeKDyb31ETzyZLnjM2qNJV9bbNprHcCZp2QVjI+Io4LdckEJsQvWdL3tDzGegTnjvit8JyFMrzELDKw1/mcJEffgJY1bpycXiAAfbozNAu/TaulqA1T3xpA/68jp29bR/Hc1C7T/P4E/UjbkU66HGn4aVRqO7xa6UTb7+H89M6RnL7LDbJMbeM5wEm3ywHbF0PzJK9Qim4B4MLnVIN6fMwuExS31kYDB3jvzM3D4iGo1W32GktBGQgIur1onEb6wmTJco8AFQqFTy/R/TEMXNtzGTzQ9/wlLmCPeogBEcP+Eqge6wIDAQAB"
networkstack_cert_release="308203453082022DA00302010202147C15366D0D3D88650EEDCC4E5B478ABA1150EBA4300D06092A864886F70D01010B05003031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E3020170D3234303532363230333332385A180F32303531313031323230333332385A3031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E30820122300D06092A864886F70D01010105000382010F003082010A0282010100F38242C2EED8926F3E1F888162990DA3A7B75E0902414AB8569B4B69A78A0F26F7D444F3C992E78CCDAA34957D6DB369AC7702669D9056323E228E0B75C90426C42F59D2F7B43CC67A04E78EF8ADF09C8532BCC42C32B0D7F99C2447DF8096356E9C9C5E20007DBA33340BBF4DABA5A80D53DF1A40FFAF23A76F5B47F1DCD42ED3FCFE04FD48DB914EBA1C69F869546A3BBC5AE944DBEFE1FCF4CE919CBECB0DB24C6DE339C049B7CB01DB1743F324AF508A6E01E0C2E754837A7CCC2E1314B7D646030778EFCCCDC3E221A8D56DF61A4B41190808BABD689C46FAC264C9728F00150A854F2FD1FD310C5CDB73193CD0F7FC252E608F7A880111C3FE12A81EEB0203010001A3533051301D0603551D0E04160414CC4A2AB4F68081FD3EC200D8EEE2F2ACCBE9DC87301F0603551D23041830168014CC4A2AB4F68081FD3EC200D8EEE2F2ACCBE9DC87300F0603551D130101FF040530030101FF300D06092A864886F70D01010B05000382010100B0A7467026A2976FF23C395D15F12C1108A225A362200A18C5430752D0E04141627861FF38958E6536382D65EA92AD579767648D288D79C5F3B1DA95777E4A4F7092FF5919C28D3B351126B45B4EF0770AFBF3B832403C311C4E0B66135E7944407AC42D468759BE94CF35449F0F1070541243BA7444AE1598F75E7C26DF59B0DFF6209010F06ECB55602BA2CF62B06E5B2E8F18DB8E55F0F5B03DC57312F56F154ED3411EE8D7168ED6B42F1210DC22A887E59CFB6E8C8E8D4CC4BD6C6EAD8C8F00FAA097F6CC774D8B340F334A99491483FD32461278EC8F07CBED3AC38101144FF8DF6423FCFDAAB5EF803AC7A1EFE624049A4A531CFE36B2428F104DFE81"
platform_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA5955y3KbDK3FbQ0+CMslAGbzRFHBVZDaPouHHSHt6hRZ7iPDha1yjH84MWlMKxYFysEjesXM9gFPmGKzkKun3zrFIXFhpWsjekFTFjMKsXnS8q0XvQtKhkw+hMG/KA95FY5iNWAIfsfh8JtdKUz5rSqJ0Zji+7IAotcZ6AJJeUM/8qWRtLMFXvOz16oy3R3zTPn4vFTSxPSXkwedJVcGF98W41QGmnPraBFe8CyHRVcoLwiW1dUrUd+kxEjeGsBsZN5iDYciG++Mlf5DH81HHpoCgf3uevpzvhHW5PlweX1mYL56YopaAWpRXDdv1uJcdrVGNyK+dzt6BxUzOoKSHwIDAQAB"
platform_cert_release="308203453082022DA00302010202141BD4CB3A45B3338E1E07D3CB2381918A1AB17FF1300D06092A864886F70D01010B05003031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E3020170D3234303532363230333332385A180F32303531313031323230333332385A3031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E30820122300D06092A864886F70D01010105000382010F003082010A0282010100E7DE79CB729B0CADC56D0D3E08CB250066F34451C15590DA3E8B871D21EDEA1459EE23C385AD728C7F3831694C2B1605CAC1237AC5CCF6014F9862B390ABA7DF3AC5217161A56B237A415316330AB179D2F2AD17BD0B4A864C3E84C1BF280F79158E623560087EC7E1F09B5D294CF9AD2A89D198E2FBB200A2D719E8024979433FF2A591B4B3055EF3B3D7AA32DD1DF34CF9F8BC54D2C4F49793079D25570617DF16E354069A73EB68115EF02C874557282F0896D5D52B51DFA4C448DE1AC06C64DE620D87221BEF8C95FE431FCD471E9A0281FDEE7AFA73BE11D6E4F970797D6660BE7A628A5A016A515C376FD6E25C76B5463722BE773B7A0715333A82921F0203010001A3533051301D0603551D0E041604149B089437B7B30408878307C9BB73726786F3B38D301F0603551D230418301680149B089437B7B30408878307C9BB73726786F3B38D300F0603551D130101FF040530030101FF300D06092A864886F70D01010B05000382010100C5D61A812B8580521CC8455C3B1BAEB86A3E0E28C07DBF2E1803B3014B19BE1D104CC20B019548E8EBFB9D6A7883DC92506A2D2C216E169563D80DCC473649811AF4E60AE96301E7B920D4E19E811462F60C17792CBD659646B50EC58A9D88F4E073DBEDDB70A27691A4BD230F8C3D7F47B582E704302E573E3E2889520D4235B53CB744AF29EB0B89EDC1459FA8BF016C4EDBDB265A47EBC46EFF52636217F56F7F36AAC06A00F18160B7FAEB21B6B89F0EC835EAD14929BAAD195FD37AAE10F559E3A5EE4896381302424AB7A04B155C08AC6DD75BB7130A35C6C9ACEB8E11536A292793B3100C706DBB09B3FD3DB6FFB8D49390628A7747A69071830949BF"
sdk_sandbox_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqiH3qbeAd03vycnPQPv43w0wiQUVOXkoUy17yYYnL5rJFGbN8NlEtUVQW9/Bb6Cux/qgXOqhqGfeuFQUq3O+9E72mWoarsJQXDoMqkWS3/3FywP3DonUCKeF6XKmEoGvniJBj0VJfnykB2Ga1OAmckMVNKGMPj5K4Vvc3j/Nk7VILhUHsZOUBcrdoCbm6hb6FTkRfISYdg5Mu6QG7Q0Y+VrDZ4yTMmBm7xJYK3cIQe6G5roLs7tmz5c3WJqxWgvX6TJ4++OzV0TFAdmuPvtLrsNXr/k6EmGWiDtNgtOCl5RYGkmgKO7ElGypQMMBgxZVQ6Hz2qdw2rF7gCNzQ17euQIDAQAB"
sdk_sandbox_cert_release="308203453082022DA00302010202143142E5A2E0FFD29773753587AF1DD1C5388918E9300D06092A864886F70D01010B05003031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E3020170D3234303532363231303433315A180F32303531313031323231303433315A3031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E30820122300D06092A864886F70D01010105000382010F003082010A0282010100AA21F7A9B780774DEFC9C9CF40FBF8DF0D30890515397928532D7BC986272F9AC91466CDF0D944B545505BDFC16FA0AEC7FAA05CEAA1A867DEB85414AB73BEF44EF6996A1AAEC2505C3A0CAA4592DFFDC5CB03F70E89D408A785E972A61281AF9E22418F45497E7CA407619AD4E02672431534A18C3E3E4AE15BDCDE3FCD93B5482E1507B1939405CADDA026E6EA16FA1539117C8498760E4CBBA406ED0D18F95AC3678C93326066EF12582B770841EE86E6BA0BB3BB66CF9737589AB15A0BD7E93278FBE3B35744C501D9AE3EFB4BAEC357AFF93A126196883B4D82D3829794581A49A028EEC4946CA940C30183165543A1F3DAA770DAB17B802373435EDEB90203010001A3533051301D0603551D0E041604142840D76329D7867D3083D618DC1FC94D6FE4455D301F0603551D230418301680142840D76329D7867D3083D618DC1FC94D6FE4455D300F0603551D130101FF040530030101FF300D06092A864886F70D01010B0500038201010098C764DEC49D6E7A93386807A9D4F641590CB450297B85D363ADAD9FA560B89809880C0DFC7828833E85693EBCFB7B02D6120507B3834A4E15EBD80A8FC31C333FD26FE2BCEFE66BB21C0B6BCA0E5C87C7D8BFC2291A744A06AD9291DAB17AE930EDB02851F81FE219BF40778A3E223072655AD04E5B8CEAB24EB0E89F3319E34DD125EADE6303DE8CEC1581C5B9E2EC32BDCAB134DB8ABE09A9CF35AEA377B1B4DAF402F4FC58C8C14CB9870340E43688D2CCA78A975F9B191780A68CF3BE85F48CB8CD869F9F737B8A7A6F61DE25F9A926B207255ABCCDAA5A792CAB9F4E36A0BC84B95EDA8A9CB9349B481E27A9D347CAFCFAF70856E5A945E2E21930BDB6"
shared_key_release="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAqFOeB95t0nmhk/E5xJkwFILbybLujWitoU85gSGfgjxt06cBDY3VN2zIm/xxgP90+adK7hO+rtn4DH8fwywymI2dwxczZOq9Hxv19inMjraFkDXFxhra/G96cwxwWVFGfXOAYwfEsvnSt1AuFDcP3GyAxlCqId626NSAREkTU2VNlT5CsMAZyrjPSit5mUjaAwg/G5/oG7X8SO31e/bnXIVuoaB0aInFRhw7oq30L5+RsJiOgD55u3/KeAwlBTvoL0YAkALGpUvwYIHY/DkVbpIGgV+Bao3Ij0RXeDL6NqRMuBFbXXmFF9C5Lr5aYSCPVl+4inG+8jAXX0l6oHbX6QIDAQAB"
shared_cert_release="308203453082022DA003020102021447B78F5AC1F5B912B4AB53AD2EDAD481B26DCDB4300D06092A864886F70D01010B05003031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E3020170D3234303532363230333332385A180F32303531313031323230333332385A3031310B3009060355040613025553310E300C06035504080C054974616C793112301006092A864886F70D01090116034E614E30820122300D06092A864886F70D01010105000382010F003082010A0282010100A8539E07DE6DD279A193F139C499301482DBC9B2EE8D68ADA14F3981219F823C6DD3A7010D8DD5376CC89BFC7180FF74F9A74AEE13BEAED9F80C7F1FC32C32988D9DC3173364EABD1F1BF5F629CC8EB6859035C5C61ADAFC6F7A730C705951467D73806307C4B2F9D2B7502E14370FDC6C80C650AA21DEB6E8D48044491353654D953E42B0C019CAB8CF4A2B799948DA03083F1B9FE81BB5FC48EDF57BF6E75C856EA1A0746889C5461C3BA2ADF42F9F91B0988E803E79BB7FCA780C25053BE82F46009002C6A54BF06081D8FC39156E9206815F816A8DC88F44577832FA36A44CB8115B5D798517D0B92EBE5A61208F565FB88A71BEF230175F497AA076D7E90203010001A3533051301D0603551D0E04160414BA0DFC60193BBAA090D38F5FEFF14364FD0CDC1B301F0603551D23041830168014BA0DFC60193BBAA090D38F5FEFF14364FD0CDC1B300F0603551D130101FF040530030101FF300D06092A864886F70D01010B050003820101008F2B394A2F7A44A957806B4ADC7125050AC047781758B6716B158A43579A6A58A5257C164B057718C8149FD3B93E16398AFA0D49DDC75327E71340A3ED1E63C152D8AC627A13BCE0BE9160D1FA3AC7C6A4471A81579A2EE393D2DFE3DD9B7D3F542940F7AE05AEA8005DEEFB8811B5D80BA40276ED1ADE8E63848C8F8AB70EDCE9B55142C143918717EAB00F4FEA89AE379FCB5AF5FD408B1CD8F15CF5328944A09D260C57E3E4F808DAFAFCCDE4F3ADE04226E76CC9275137D8B2B120624B5034EFC5392CCEDD0B9BFE81341603CC718B5EAF8BD0B96EBC12C4C18DA1CBDE28ECB4F0749251C1DECB833E087112717087C7DCEE4EC7EBDF952E026F34D98D82"

# Previous public keys
bluetooth_key_test="MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAsVlq9pozUREGlb8u8Y0AfYwPs5OuavNx/EsX03aTjmAXUfSOMAewqzUXDIRjw8UQvOW63utaZ0go9osDPzNfVEftmGxW/AUC+HWGaLDQfCYO3ficPPOS7xpEhGZERNbnhvh5qX0NBt6mJygsfpOmRPThbi6Ig2Brxh1eqVYqRkTjhNFKD6gCd1PdMmUSF88xEYaZWvTkET89Zh38lLza2x/wfNZmCSAVurNw1Kf9NQfYsaGHwMsjrvTyhG93TTYXzRBFzAO2WlBiw6R0tQr8ZW5XCM9Yo6AS0KXiU0ZWwOXxhGdr38rNd7j9nZtpFwWmN1kgeb/vpEfq0Ylua9ByuURnfJZu2K4TbFamuyjihItra2ZKOtFNPDeuggKMCkuZz6WU8FCoMEpnq5P2agxNOGAa7ynXdNzek98N3TGX8qtfEgCv6vyuM0gakJ6D9nM43nsCm1LkB/JA0CacWyRzljaLL1C4S43azEOYyOOb94ITnkZCQGtH33kxzamyPLIZ37VF4+v6yTXySLBzOnheOs5uBIDohVJuI838bLhZf8e5mIrnjiKwsmExXiQvgidbwvZKCz9n8YT4iUhWPx4FW+GPcivZsvsECcnJ2QURK1zhir5QuLS7ZbAth4kiEUxJ6ujF5jftE+L/ClK2LiY02IXWRCct8J1hfJZZx8lm3PUCAwEAAQ=="
bluetooth_cert_test="3082063B30820423A003020102021412265AA5A599552B5EAF4E8224C7F69078BC3C8B300D06092A864886F70D01010B05003081AB310B30090603550406130255533113301106035504080C0A43616C69666F726E69613116301406035504070C0D4D6F756E7461696E20566965773110300E060355040A0C07416E64726F69643110300E060355040B0C07416E64726F69643127302506035504030C1E636F6D2E616E64726F69642E626C7565746F6F74682E73657276696365733122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D3020170D3232303331353030333630335A180F34373630303230393030333630335A3081AB310B30090603550406130255533113301106035504080C0A43616C69666F726E69613116301406035504070C0D4D6F756E7461696E20566965773110300E060355040A0C07416E64726F69643110300E060355040B0C07416E64726F69643127302506035504030C1E636F6D2E616E64726F69642E626C7565746F6F74682E73657276696365733122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D30820222300D06092A864886F70D01010105000382020F003082020A0282020100B1596AF69A3351110695BF2EF18D007D8C0FB393AE6AF371FC4B17D376938E601751F48E3007B0AB35170C8463C3C510BCE5BADEEB5A674828F68B033F335F5447ED986C56FC0502F8758668B0D07C260EDDF89C3CF392EF1A4484664444D6E786F879A97D0D06DEA627282C7E93A644F4E16E2E8883606BC61D5EA9562A4644E384D14A0FA8027753DD32651217CF311186995AF4E4113F3D661DFC94BCDADB1FF07CD666092015BAB370D4A7FD3507D8B1A187C0CB23AEF4F2846F774D3617CD1045CC03B65A5062C3A474B50AFC656E5708CF58A3A012D0A5E2534656C0E5F184676BDFCACD77B8FD9D9B691705A637592079BFEFA447EAD1896E6BD072B944677C966ED8AE136C56A6BB28E2848B6B6B664A3AD14D3C37AE82028C0A4B99CFA594F050A8304A67AB93F66A0C4D38601AEF29D774DCDE93DF0DDD3197F2AB5F1200AFEAFCAE33481A909E83F67338DE7B029B52E407F240D0269C5B247396368B2F50B84B8DDACC4398C8E39BF782139E4642406B47DF7931CDA9B23CB219DFB545E3EBFAC935F248B0733A785E3ACE6E0480E885526E23CDFC6CB8597FC7B9988AE78E22B0B261315E242F82275BC2F64A0B3F67F184F88948563F1E055BE18F722BD9B2FB0409C9C9D905112B5CE18ABE50B8B4BB65B02D878922114C49EAE8C5E637ED13E2FF0A52B62E2634D885D644272DF09D617C9659C7C966DCF50203010001A3533051301D0603551D0E04160414EE4282D43329B4C477F43DAF12B5E1AF41070159301F0603551D23041830168014EE4282D43329B4C477F43DAF12B5E1AF41070159300F0603551D130101FF040530030101FF300D06092A864886F70D01010B050003820201006AC64B5CE66A801156AEEA86863EC7349CD48FD3CDFEAF1BA687042F82708A12336A2AAFA4C61FE0031C063A8E1BBFAB3BF58A3DE0B6822702406D916BD8B0221578848F8FC42899C77C108796EFBA7E02B2B34B81D8E66D5CFCEE03FF9AE497A7347B116AE0F770F55F31C8CF7C42D2DDA23E31CF35D44CF388C2444E1E48FCA2D70C2F6F26FCC0B497FE1BF9F9479CFA8A16E2C18E1C62F5BFD97F06977E39314DC5E93379CF1FCCCDEE4689A52D5F3D6D48272C4962F4F4DB6B8AF9A7E97B34E6C92FF9D1A3A77141A30C9470F0270E07CF0EF25A62CC30F7B43ECFEA354EA514494B84A791512B6C89F5C5D58447AB9B8679F2707ED4983548C7EBCD77FB7A6036B7EFB6AEF196BE2E76C33DF575F8E83E45A2521088C981F632AA78C1C4675118DDB555BA89751CE8FDE3B864577698656D328B15AF48F0E0EF2BEB4A3DA0C3160536C5A71388F76F5075C57E5F52F3F00F01673D1F6977D9D99F6EB1CB6E5B616D6607B7B6C274EF3EE4BA135D6E79B6C9055F77416A889B1AA548E586071D155A0358FBAA39F580A06DF56E57BA7A2367C5F8E209C90F5B2722204EA5C3DEE7BDABC68E551A707E6A546F3A84E594EF1C8181E4343C7E1EF8DC6BE74C9403418CC678B581E7D9146F2A10F74D46E0D3D5076A0C687FF046B5D46114317740C64D14CEAC80B4B0EBE8C6F02BA9559AA99EB9E15DA20763BD0DE65DEF78"
media_key_test="MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAriUMWhbvl/woaaxlGzIXzDa6DoaWQWjVigSfQM6FhnEjo/+09tlJwzzy2joFwj6sqlfYA4ibF1m89Z58byGJCuJQhbftVqpibAmJ75zNNjYsoOjRuWA/1Ngyh2eSbMwJDGi3da5/8wk0zDae8oVaJmffDGZ/0MfPXY66ZVgGc3MDu2JHJuq67fty8H7Xp2qzy5o4HEt9zYCbFA2JHwAhO+QB9Y1qBqYercOpwvHGVnKFsJrgk0Kmb6Qh6vk633VzoCjDMdcGAas698yEAz7OfHcqOluGsNvp13fDpIqpgB7c7ieBWJ9E2eQROXlgBXaplBC6gQkSWdrZjGxo/3hLjwIBAw=="
media_cert_test="308204A830820390A003020102020900F2B98E6123572C4E300D06092A864886F70D0101040500308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D301E170D3038303431353233343035375A170D3335303930313233343035375A308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D30820120300D06092A864886F70D01010105000382010D00308201080282010100AE250C5A16EF97FC2869AC651B3217CC36BA0E86964168D58A049F40CE85867123A3FFB4F6D949C33CF2DA3A05C23EACAA57D803889B1759BCF59E7C6F21890AE25085B7ED56AA626C0989EF9CCD36362CA0E8D1B9603FD4D8328767926CCC090C68B775AE7FF30934CC369EF2855A2667DF0C667FD0C7CF5D8EBA655806737303BB624726EABAEDFB72F07ED7A76AB3CB9A381C4B7DCD809B140D891F00213BE401F58D6A06A61EADC3A9C2F1C6567285B09AE09342A66FA421EAF93ADF7573A028C331D70601AB3AF7CC84033ECE7C772A3A5B86B0DBE9D777C3A48AA9801EDCEE2781589F44D9E4113979600576A99410BA81091259DAD98C6C68FF784B8F020103A381FC3081F9301D0603551D0E04160414CA293CAA8BC0ED3E542EEF4205A2BFF2B57E4D753081C90603551D230481C13081BE8014CA293CAA8BC0ED3E542EEF4205A2BFF2B57E4D75A1819AA48197308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D820900F2B98E6123572C4E300C0603551D13040530030101FF300D06092A864886F70D0101040500038201010084DE9516D5E4A87217A73DA8487048F53373A5F733F390D61BDF3CC9E5251625BFCAA7C3159CAE275D172A9AE1E876D5458127AC542F68290DD510C0029D8F51E0EE156B7B7B5ACDB394241B8EC78B74E5C42C5CAFAE156CAF5BD199A23A27524DA072DEBBE378464A533630B0E4D0FFB7E08ECB701FADB6379C74467F6E00C6ED888595380792038756007872C8E3007AF423A57A2CAB3A282869B64C4B7BD5FC187D0A7E2415965D5AAE4E07A6DF751B4A75E9793C918A612B81CD0B628AEE0168DC44E47B10D3593260849D6ADF6D727DC24444C221D3F9ECC368CAD07999F2B8105BC1F20D38D41066CC1411C257A96EA4349F5746565507E4E8020A1A81"
networkstack_key_test="MIICIjANBgkqhkiG9w0BAQEFAAOCAg8AMIICCgKCAgEAu3H1E3/wstdXrMLKPTeOD43hEJDVyvPUnjFNNcKDt3iwLXktjrpEA2TKlwmFRBZg8LwAr7xj3WEbG/Ua0ooe3SHgBI9Ui4D4vRE+JWgoIvV9q4Jzr68Sxk0ZoMa+I48+Zt3HmxD9kmkx4+5gp79hhkTaPCxPxCgTnUXSe+2n/kXjAHW0k+rW7AHN1V2THAplfi5ZdCymMrbcOEKi3rfSJEPICSkdelSSA65q41ZYKkyiPzDwVJxOyECKdSeOlcaeg5CtUoC876728TCaQb2fO/tdEtyn557G/WhIGT+pq3KCJIh7T5Pphex8v2QBsOhjpLkcBdBG8ED+lUAEsWRZVPy0EUzuHotktH1xmhnvTAAcsYP38+Fm5D9W1oBHw0QNo0/fUp1EJ0uLL2r7NFCRrYrUuTvVxV1SKGpdPBV0ZduN32LnzbaxD7GIiARq/dJjrm8hJdkGV1nH5C+GEKZ0btvcVH1DAWEu7sPDy9Ek3s7MjTiyDnOxPyTufKE6mMX2HwyBsH0rUZdJvCvLnglJrvbBGKPoEl5qtX/ORrsJGmZ0DhCzHHQLiRkAwOzanMaey08zaZmLF1EG3QpP/XAk6351/t0aWxMdC7K0DGNJHjz4a4lXshUhs6lu0TdqUaasaXhmsCVt7hvNmrmhiL9M7YC1ml8kwtqaVet7DlAhFuMCAwEAAQ=="
networkstack_cert_test="308205DC308203C4A003020102020900FC6CB0D8A6FDD168300D06092A864886F70D01010B0500308181310B30090603550406130255533113301106035504080C0A43616C69666F726E69613116301406035504070C0D4D6F756E7461696E20566965773110300E060355040A0C07416E64726F69643110300E060355040B0C07416E64726F69643121301F06035504030C18636F6D2E616E64726F69642E6E6574776F726B737461636B3020170D3139303231323031343632305A180F34373537303130383031343632305A308181310B30090603550406130255533113301106035504080C0A43616C69666F726E69613116301406035504070C0D4D6F756E7461696E20566965773110300E060355040A0C07416E64726F69643110300E060355040B0C07416E64726F69643121301F06035504030C18636F6D2E616E64726F69642E6E6574776F726B737461636B30820222300D06092A864886F70D01010105000382020F003082020A0282020100BB71F5137FF0B2D757ACC2CA3D378E0F8DE11090D5CAF3D49E314D35C283B778B02D792D8EBA440364CA970985441660F0BC00AFBC63DD611B1BF51AD28A1EDD21E0048F548B80F8BD113E25682822F57DAB8273AFAF12C64D19A0C6BE238F3E66DDC79B10FD926931E3EE60A7BF618644DA3C2C4FC428139D45D27BEDA7FE45E30075B493EAD6EC01CDD55D931C0A657E2E59742CA632B6DC3842A2DEB7D22443C809291D7A549203AE6AE356582A4CA23F30F0549C4EC8408A75278E95C69E8390AD5280BCEFAEF6F1309A41BD9F3BFB5D12DCA7E79EC6FD6848193FA9AB728224887B4F93E985EC7CBF6401B0E863A4B91C05D046F040FE954004B1645954FCB4114CEE1E8B64B47D719A19EF4C001CB183F7F3E166E43F56D68047C3440DA34FDF529D44274B8B2F6AFB345091AD8AD4B93BD5C55D52286A5D3C157465DB8DDF62E7CDB6B10FB18888046AFDD263AE6F2125D9065759C7E42F8610A6746EDBDC547D4301612EEEC3C3CBD124DECECC8D38B20E73B13F24EE7CA13A98C5F61F0C81B07D2B519749BC2BCB9E0949AEF6C118A3E8125E6AB57FCE46BB091A66740E10B31C740B891900C0ECDA9CC69ECB4F3369998B175106DD0A4FFD7024EB7E75FEDD1A5B131D0BB2B40C63491E3CF86B8957B21521B3A96ED1376A51A6AC697866B0256DEE1BCD9AB9A188BF4CED80B59A5F24C2DA9A55EB7B0E502116E30203010001A3533051301D0603551D0E041604149383C92CFBF099D5C47B0C3657D8622A084B72E1301F0603551D230418301680149383C92CFBF099D5C47B0C3657D8622A084B72E1300F0603551D130101FF040530030101FF300D06092A864886F70D01010B050003820201006A0501382FDE2A6B8F70C60CD1B8EE4F788718C288B170258EF3A96230B65005650D6A4C42A59A97B2DDEC502413E7B438FBD060363D74B74A232382A7F77FD3DA34E38F79FAD035A8B472C5CFF365818A0118D87FA1E31CC7ED4BEFD27628760C290980C3CC3B7FF0CFD01B75FF1FCC83E981B5B25A54D85B68A80424AC26015FB3A4C754969A71174C0BC283F6C88191DCED609E245F5938FFD0AD799198E2D0BF6342221C1B0A5D332ED2FFFC668982CABBCB7D3B630FF8476E5C84AC0AD37ADF9224035200039F95EC1FA95BF83796C0E8986135CEE2DCAEF190B249855A7E7397D4A0BF17EA63D978589C6B48118A381FFFBD790C44D80233E2E35292A3B5533CA3F2CC173F85CF904ADFE2E4E2183DC1EBA0EBAE07B839A81FF1BC92E292550957C8599AF21E9C0497B9234CE345F3F508B1CC872AA55DDB5E773C5C7DD6577B9A8B6DAED20AE1FF4B8206FD9F5C8F5A22BA1980BEF01AE6FCB2659B97AD5B985FA81C019FFE008DDD9C8130C06FC6032B2149C2209FC438A7E8C3B20CE03650AD31C4EE48F169777A0AE182B72CA31B81540F61F167D8D7ADF4F6BB2330FF5C24037245000D8172C12AB5D5AA5890B8B12DB0F0E7296264EB66E7F9714C31004649FB4B864005F9C43C80DB3F6DE52FD44D6E2036BFE7F5807156ED5AB591D06FD6BB93BA4334EA2739AF8B41ED2686454E60B666D10738BB7BA88001"
platform_key_test="MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAnHgFkqwNXTgc3qpl7MimAG42SAxtcgexIBG+UIY6q+K1XQCa33FG1vIgIoDHzU172yYkO4qAbCazSxN1I6SSaCJJBNwBST58Cs8aBch09psDe2AwnZB00kKA4WutKoc0NhlR6vcqSC0JsgSxh14SrJjBqnc9aAC56v3lbVi+2OjaFvmjYAmcN6g0pt/tt7a0SgSeB6Jp/M8sVJbyzzbWTfkKO42PNKO6q0z1M3GrJ3GbO6WHVK0MU/wU4dtF1R4jT7vpPJuk7fnOVCYTUOxTVge/aaL/SqB9tffqIA0JpsG0niFAL4ntEZCJOqtakYDxUugvhaRXU89fwZBxxe7IJwIBAw=="
platform_cert_test="308204A830820390A003020102020900B3998086D056CFFA300D06092A864886F70D0101040500308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D301E170D3038303431353232343035305A170D3335303930313232343035305A308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D30820120300D06092A864886F70D01010105000382010D003082010802820101009C780592AC0D5D381CDEAA65ECC8A6006E36480C6D7207B12011BE50863AABE2B55D009ADF7146D6F2202280C7CD4D7BDB26243B8A806C26B34B137523A49268224904DC01493E7C0ACF1A05C874F69B037B60309D9074D24280E16BAD2A8734361951EAF72A482D09B204B1875E12AC98C1AA773D6800B9EAFDE56D58BED8E8DA16F9A360099C37A834A6DFEDB7B6B44A049E07A269FCCF2C5496F2CF36D64DF90A3B8D8F34A3BAAB4CF53371AB27719B3BA58754AD0C53FC14E1DB45D51E234FBBE93C9BA4EDF9CE54261350EC535607BF69A2FF4AA07DB5F7EA200D09A6C1B49E21402F89ED1190893AAB5A9180F152E82F85A45753CF5FC19071C5EEC827020103A381FC3081F9301D0603551D0E041604144FE4A0B3DD9CBA29F71D7287C4E7C38F2086C2993081C90603551D230481C13081BE80144FE4A0B3DD9CBA29F71D7287C4E7C38F2086C299A1819AA48197308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D820900B3998086D056CFFA300C0603551D13040530030101FF300D06092A864886F70D01010405000382010100572551B8D93A1F73DE0F6D469F86DAD6701400293C88A0CD7CD778B73DAFCC197FAB76E6212E56C1C761CFC42FD733DE52C50AE08814CEFC0A3B5A1A4346054D829F1D82B42B2048BF88B5D14929EF85F60EDD12D72D55657E22E3E85D04C831D613D19938BB8982247FA321256BA12D1D6A8F92EA1DB1C373317BA0C037F0D1AFF645AEF224979FBA6E7A14BC025C71B98138CEF3DDFC059617CF24845CF7B40D6382F7275ED738495AB6E5931B9421765C491B72FB68E080DBDB58C2029D347C8B328CE43EF6A8B15533EDFBE989BD6A48DD4B202EDA94C6AB8DD5B8399203DAAE2ED446232E4FE9BD961394C6300E5138E3CFD285E6E4E483538CB8B1B357"
sdk_sandbox_key_test="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA09j3dyTxv8ojb4sXjrWXsmXTYEez/u6X6po8+mWXp1xl1Y9xjYrxZROIE1MJL8aay8iYJihqx7RBWTPJYtYZTLElA3dyQuMgDIKtlQR3QAMRoc2IKrkfcIboEs71xl78EnTSQfRJTUEFvNigzjfBe3JVtNDC9BR/33Iv9oNED84qW9C54h4TWHLyvo75unzPQUGS6uEIhhHa/8ynZZQWYEd0NwAQNqbcMdbN8Bn6sRRCidEOIPd8Uu8DtIofLi7/YMo4CH1Q5f5UQbtPtqU2m8fjQN9WYzMazvWltRE+HYDH9YnXCLAsVicNdmFhAlXri15nG2AiRnSrHu/panAc6wIDAQAB"
sdk_sandbox_cert_test="3082040B308202F3A0030201020214316246427AC953BCC11293EABFADEED873A589BD300D06092A864886F70D01010B0500308194310B30090603550406130255533113301106035504080C0A43616C69666F726E69613116301406035504070C0D4D6F756E7461696E20566965773110300E060355040A0C07416E64726F69643110300E060355040B0C07416E64726F69643110300E06035504030C07416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D301E170D3231313130323137303231345A170D3439303332303137303231345A308194310B30090603550406130255533113301106035504080C0A43616C69666F726E69613116301406035504070C0D4D6F756E7461696E20566965773110300E060355040A0C07416E64726F69643110300E060355040B0C07416E64726F69643110300E06035504030C07416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D30820122300D06092A864886F70D01010105000382010F003082010A0282010100D3D8F77724F1BFCA236F8B178EB597B265D36047B3FEEE97EA9A3CFA6597A75C65D58F718D8AF16513881353092FC69ACBC89826286AC7B4415933C962D6194CB12503777242E3200C82AD950477400311A1CD882AB91F7086E812CEF5C65EFC1274D241F4494D4105BCD8A0CE37C17B7255B4D0C2F4147FDF722FF683440FCE2A5BD0B9E21E135872F2BE8EF9BA7CCF414192EAE1088611DAFFCCA765941660477437001036A6DC31D6CDF019FAB1144289D10E20F77C52EF03B48A1F2E2EFF60CA38087D50E5FE5441BB4FB6A5369BC7E340DF5663331ACEF5A5B5113E1D80C7F589D708B02C56270D7661610255EB8B5E671B60224674AB1EEFE96A701CEB0203010001A3533051301D0603551D0E04160414DC5E6BD838496D17E424ABAAB358633FFD1D0941301F0603551D23041830168014DC5E6BD838496D17E424ABAAB358633FFD1D0941300F0603551D130101FF040530030101FF300D06092A864886F70D01010B05000382010100C1043CFC3DDFFD64B9730A9CB05A53F90CE293DC93BB9DE7B17CFFA410D26DE337CD7D5109E8D7B265E13E337B72ED2E25896B22E02B39A807482E690DC8BA1B3730BA79E79116B3480993A472D246079B70B80A1CB0A987DB2E948D6BF36C7DBA9178EF32E56DF913AED189AF27A3FB2589D8D7BC8AB2483DE351D33D2C4C1589D8D820E797B31568F79A2873C3867A614F6DC4907B1A3F5E3585DD72E6E3A0DB3699253FE9D47E1F026D0FAE05B87DF140B18C66C722CC237C37A6F9C5ACA3C0FB2CCD085A1C8E22478A0627DA6B6C3774268CA5C16AF62EB42162E5900A7DB4706E5886BB59B218FA7F57865754C361DF31CE26A98A5AB0CEB721011BCFF2"
shared_key_test="MIIBIDANBgkqhkiG9w0BAQEFAAOCAQ0AMIIBCAKCAQEAyMLb/QlKLfRcP/GjLtIYBexy/FjQF5cb0Pa1LCYtcIGdGRln4Vjf06LH8bPg6AzlRdedKEgiAhHrhvD9gxLTe0IMETdQzJRhiuhy9IhkY73EYnyqDASDyGST41FVcRcDOL/cxM1q3dHAovNfXPJO0+QEOj5Y4rBeZkzN4SvLZ3Nf1t8SScNp5iVCvApHKeU5F/XDj/pS0Xtzycc3mN2xjtSBWQh1VH5mv8XaykwlpuuWDtlpI3CdowK6ZGy0lrMl6Gxciy56M3eyu+THzzMlQpEWP2iRUqwIhVDIPFCPS/Wt8K7VotygWD+asK0XZQ237qSyP9tFiFVH0P6rchg4iQIBAw=="
shared_cert_test="308204A830820390A003020102020900F2A73396BD38767A300D06092A864886F70D0101040500308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D301E170D3038303732333231353735395A170D3335313230393231353735395A308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D30820120300D06092A864886F70D01010105000382010D00308201080282010100C8C2DBFD094A2DF45C3FF1A32ED21805EC72FC58D017971BD0F6B52C262D70819D191967E158DFD3A2C7F1B3E0E80CE545D79D2848220211EB86F0FD8312D37B420C113750CC94618AE872F4886463BDC4627CAA0C0483C86493E3515571170338BFDCC4CD6ADDD1C0A2F35F5CF24ED3E4043A3E58E2B05E664CCDE12BCB67735FD6DF1249C369E62542BC0A4729E53917F5C38FFA52D17B73C9C73798DDB18ED481590875547E66BFC5DACA4C25A6EB960ED96923709DA302BA646CB496B325E86C5C8B2E7A3377B2BBE4C7CF33254291163F689152AC088550C83C508F4BF5ADF0AED5A2DCA0583F9AB0AD17650DB7EEA4B23FDB45885547D0FEAB72183889020103A381FC3081F9301D0603551D0E04160414CB4C7E2CDBB3F0ADA98DAB79968D172E9DBB1ED13081C90603551D230481C13081BE8014CB4C7E2CDBB3F0ADA98DAB79968D172E9DBB1ED1A1819AA48197308194310B3009060355040613025553311330110603550408130A43616C69666F726E6961311630140603550407130D4D6F756E7461696E20566965773110300E060355040A1307416E64726F69643110300E060355040B1307416E64726F69643110300E06035504031307416E64726F69643122302006092A864886F70D0109011613616E64726F696440616E64726F69642E636F6D820900F2A73396BD38767A300C0603551D13040530030101FF300D06092A864886F70D0101040500038201010040A8D096997959E917A36C44246B6BAC2BAE05437ECD89794118F7834720352D1C6F8A39B0869942F4DA65981FAA2951D33971129EC1921D795671C527D6E249F252829FAF5B591310311E2DE096500D568AD4114A656DC34A8C6F610453AFC1EA7992DBA4AA7B3F8543A6E35C0728DE77FE97EEAC83771FD0EC90F8E4449434EE0B6045783E70C7A2E460249260E003CF7608DC352A4C9EF706DEF4B26050E978AE2FFFD7A3323787014915EB3CC874FCC7A9AE930877C5C8C7D1C2E2A8EE863C89180D1855CEDBA400E7BA43CCCAA7243D397E7C0E8E8E4D7D4F92B6BBEAD49C0CF018069EDDCA2E7E2FB4668D89DBBD7950D0CD254180FA1EAAFC2A556F84"


PACKAGES=/data/system/packages.xml
PACKAGES_BACKUP=/data/system/packages-backup.xml
MODIFICATION_TARGET=$PACKAGES

# If there's a "backup" copy, then the current packages.xml might
# be corrupted, so overwrite it with the backup copy. This is what
# PackageManager would do.
if [ -f $PACKAGES_BACKUP ]; then
    mv $PACKAGES_BACKUP $PACKAGES
fi

if [ ! -f $PACKAGES ]; then
    exit 2
fi

# Save a copy of the current file, not to be confused with
# packages-backup.xml, which is used and generated by Android
cp $PACKAGES $PACKAGES.bak

/system/bin/sed -i "s#$media_cert_test#$media_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$platform_cert_test#$platform_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$shared_cert_test#$shared_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$bluetooth_cert_test#$bluetooth_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$sdk_sandbox_cert_test#$sdk_sandbox_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$networkstack_cert_test#$networkstack_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$media_key_test#$media_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$platform_key_test#$platform_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$shared_key_test#$shared_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$bluetooth_key_test#$bluetooth_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$sdk_sandbox_key_test#$sdk_sandbox_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$networkstack_key_test#$networkstack_key_release#g" $MODIFICATION_TARGET

/system/bin/chmod 660 $PACKAGES
/system/bin/chown system:system $PACKAGES

PACKAGES_COPY=/data/system/packages.xml.reservecopy
MODIFICATION_TARGET=$PACKAGES_COPY

if [ -f $PACKAGES_BACKUP ]; then
    mv $PACKAGES_BACKUP $PACKAGES
fi

if [ ! -f $PACKAGES_COPY ]; then
    exit 3
fi

cp $PACKAGES_COPY $PACKAGES_COPY.bak

/system/bin/sed -i "s#$media_cert_test#$media_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$platform_cert_test#$platform_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$shared_cert_test#$shared_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$bluetooth_cert_test#$bluetooth_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$sdk_sandbox_cert_test#$sdk_sandbox_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$networkstack_cert_test#$networkstack_cert_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$media_key_test#$media_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$platform_key_test#$platform_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$shared_key_test#$shared_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$bluetooth_key_test#$bluetooth_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$sdk_sandbox_key_test#$sdk_sandbox_key_release#g" $MODIFICATION_TARGET
/system/bin/sed -i "s#$networkstack_key_test#$networkstack_key_release#g" $MODIFICATION_TARGET

/system/bin/chmod 660 $PACKAGES_COPY
/system/bin/chown system:system $PACKAGES_COPY

/system/bin/touch $migration_file

exit 0
